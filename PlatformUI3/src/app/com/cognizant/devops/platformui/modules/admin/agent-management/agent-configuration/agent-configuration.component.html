<!--
*******************************************************************************
 * Copyright 2017 Cognizant Technology Solutions
 * 
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 * 
 *   http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 ****************************************************************************** -->
<div class="pageCss">
  <div layout layout-align="left" class="titleStyle">
    <div>Configuration |
      <a class="greenTitleTxt">Agent Management </a>
    </div>
  </div>

  <div class="orangeStripCss"></div>

  <div layout layout-align="left" class="sectionHeadingStyle">
    <div layout> &nbsp; {{btnValue}} Agent</div>
  </div>

  <form #frmagentconfig="ngForm" class="form">
    <div class="agentConfigTable" layout layout-align="center center" *ngIf="!showConfig">
      <h3 class="agentdefaultMessage">{{showMessage}} </h3>
    </div>
    <div class="arrange-horizontally button-row">
      <div>
        <mat-select required [(ngModel)]="selectedOS" name="selectedOS" class="form-control" placeholder="Select OS" (ngModelChange)="versionOnChange(selectedVersion, 'validate')"
          style="width:195px;">
          <mat-option *ngFor="let os of osLists | keyvalue" value="{{os.value}}">{{os.key}}</mat-option>
          </mat-select>
      </div>

      <div>
        <mat-select required [(ngModel)]="selectedVersion" name="selectedVersion" class="form-control" placeholder="Select Version"
          (ngModelChange)="versionOnChange(selectedVersion, btnValue)" style="width:195px;">
          <mat-option *ngFor="let key of versionList" value="{{key}}">{{key}}</mat-option>
          </mat-select>
      </div>

      <div>
        <mat-select required [(ngModel)]="selectedTool" name="selectedTool" class="form-control" placeholder="Select Tool" (ngModelChange)="getAgentConfig(selectedVersion, selectedTool)"
          style="width:195px;" [disabled]="btnValue == 'Update'">
          <mat-option *ngFor=" let tool of toolsArr | keyvalue" value="{{tool.value}}">{{tool.value}}</mat-option>
          </mat-select>
      </div>
      <div>
        <button mat-raised-button (click)="saveData(btnValue)" [disabled]="frmagentconfig.invalid" class="configureBut" style="width:159px;">
          {{btnValue}}
        </button>
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center">
      <mat-progress-spinner [diameter]="142" *ngIf="showThrobber" color="primary" mode="indeterminate">
      </mat-progress-spinner>
    </div>


    <div class="agentConfigTable" layout layout-align="start center" *ngFor="let configData of getAgentConfigItems('object')">
      <table>
        <thead class="theadCss">
          <tr layout="row" layout-align="start start">
            <th flex="22.5" class="tableHeader">
              <span class="tableHeadingStyle" style="text-transform: capitalize;">
								{{configAbbr[configData.key]}}
							</span>
            </th>
          </tr>
        </thead>
        <tbody layout layout-wrap layout-margin layout-padding>
          <tr flex="30" layout layout-align="start start" *ngFor="let configDataChild of configData.children" style="display: inline-table;">
            <td class="agentlistLabel">
              <span class="dataHead">{{configDataChild.key}}</span>
            </td>
            <td>
              <input class="inputBoxCont" [(ngModel)]="configDataChild.value" name="{{configDataChild.value}}">
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="others" layout layout-align="start center" *ngIf="showConfig">
      <table class="md-api-table-landing">
        <thead class="theadCss">
          <tr layout="row" layout-align="start start">
            <th flex="22.5" class="tableHeader">
              <span class="tableHeadingStyle">Others</span>
            </th>
          </tr>
        </thead>
        <tbody layout layout-wrap layout-margin layout-padding>
          <tr flex="30" layout layout-align="start start" *ngFor="let configData of getAgentConfigItems('all')" style="display: inline-table;">
            <td class="agentlistLabel">
              <span class="dataHead">{{configData.key}}</span>
            </td>
            <td>
              <input class="inputBoxCont" [(ngModel)]="configData.value" name="{{configData.key}}">
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="others" layout layout-align="start center" *ngIf="showConfig">
      <table class="md-api-table-landing">
        <thead class="theadCss">
          <tr layout="row" layout-align="start start">
            <th flex="22.5" class="tableHeader">
              <span class="tableHeadingStyle">Dynamic Data</span>
            </th>
          </tr>
        </thead>
        <tbody>
          <div class="agentConfigTable" layout layout-align="start center" *ngFor="let configData of getAgentConfigItems('dynamicTemplate')">
            <textarea [(ngModel)]="configData.value" name="{{configData.value}}" rows="5" class="frmTxtarea"></textarea>
          </div>
        </tbody>
      </table>
    </div>

    <div class="agentConfigTable fileUpload" layout layout-align="start center" *ngIf="showConfig" style="margin-top: 10px">
      <table class="md-api-table-landing">
        <thead class="theadCss">
          <tr layout="row" layout-align="start start">
            <th flex="22.5" class="tableHeader">
              <span class="tableHeadingStyle">Upload Tracking File</span>
            </th>
          </tr>
        </thead>

        <tbody layout layout-wrap layout-margin layout-padding>

          <tr flex="100" layout layout-align="start start" style="display: inline-table;">
            <td class="agentlistLabel">
              <span class="dataHead">If you are migrating previous version of agents, Please upload the tracking.JSON file of {{selectedTool}}
								agent </span>

              <div style="width:100%;background-color:#f3f3f3;margin-top:10px;border-bottom:1px solid #d8d9da">
                <div class="contentCss fnt" style="padding:15px">
                  <div layout flex="100">
                    <div style="padding-right:20px;font-size:16px;padding-top:50px;font-weight:bold;width:20%">Select a File to Upload:</div>
                    <div>

                      <div class="drop" id="dropbox">
                        <div class="cont">
                          <input #fileInput type="file" accept=".json" (change)="fileChanged($event)" />
                          <button mat-raised-button type="button" class="configureBut" (click)="uploadFile()">Upload File</button>
                          <button mat-raised-button type="button" class="configureBut" (click)="cancelFileUpload()">Cancel Upload</button>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div style="color:green;margin-left:35%;margin-top:5px">{{fileUploadSuccessMessage}}</div>
                  <div style="color:red;margin-left:35%;margin-top:5px">{{fileUploadErrorMessage}}</div>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>


  </form>

</div>